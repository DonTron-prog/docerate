{% extends "base.html" %}

{% block title %}{{ post.metadata.title }} - {{ site.title }}{% endblock %}
{% block description %}{{ post.metadata.description or post.metadata.excerpt|striptags }}{% endblock %}

{% block og_title %}{{ post.metadata.title }}{% endblock %}
{% block og_description %}{{ post.metadata.description or post.metadata.excerpt|striptags }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_url %}{{ post.url }}{% endblock %}
{% if post.metadata.image %}{% block og_image %}{{ site.url }}/images/{{ post.metadata.image }}{% endblock %}{% endif %}

{% block twitter_title %}{{ post.metadata.title }}{% endblock %}
{% block twitter_description %}{{ post.metadata.description or post.metadata.excerpt|striptags }}{% endblock %}
{% if post.metadata.image %}{% block twitter_image %}{{ site.url }}/images/{{ post.metadata.image }}{% endblock %}{% endif %}

{% block canonical %}{{ post.url }}{% endblock %}

{% block schema %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ post.metadata.title }}",
  "description": "{{ post.metadata.description or post.metadata.excerpt|striptags }}",
  "datePublished": "{{ post.metadata.date.isoformat() }}",
  "dateModified": "{{ post.metadata.date.isoformat() }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.author }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}/static/logo.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ site.url }}{{ post.url }}"
  }{% if post.metadata.image %},
  "image": {
    "@type": "ImageObject",
    "url": "{{ site.url }}/images/{{ post.metadata.image }}"
  }{% endif %},
  "keywords": [{% for tag in post.metadata.tags %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}],
  "articleSection": "{{ post.metadata.category }}",
  "wordCount": {{ post.content.split()|length }},
  "url": "{{ site.url }}{{ post.url }}"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ site.url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ post.metadata.category|title }}",
      "item": "{{ site.url }}/categories/{{ post.metadata.category }}.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ post.metadata.title }}",
      "item": "{{ site.url }}{{ post.url }}"
    }
  ]
}
</script>
{% endblock %}

{% block content %}
<article class="post-single" itemscope itemtype="https://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="headline">{{ post.metadata.title }}</h1>
        <div class="post-meta">
            <time datetime="{{ post.metadata.date.isoformat() }}" itemprop="datePublished">
                {{ post.metadata.date.strftime(config.blog.date_format) }}
            </time>
            {% if post.metadata.category %}
                <span class="separator">•</span>
                <a href="/categories/{{ post.metadata.category }}.html" class="category">
                    {{ post.metadata.category }}
                </a>
            {% endif %}
            <span class="separator">•</span>
            <span class="reading-time" data-words="{{ post.content.split()|length }}">
                {{ (post.content.split()|length / 200)|round|int }} min read
            </span>
        </div>
        
        {% if post.metadata.tags %}
        <div class="post-tags">
            {% for tag in post.metadata.tags %}
                <a href="/tags/{{ tag }}.html" class="tag">#{{ tag }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </header>
    
    {% if post.metadata.image %}
    <figure class="post-image">
        <img src="/images/{{ post.metadata.image }}" alt="{{ post.metadata.title }}" loading="lazy">
    </figure>
    {% endif %}
    
    <div class="post-content" itemprop="articleBody">
        {{ post.html|safe }}
    </div>

    <div itemprop="author" itemscope itemtype="https://schema.org/Person">
        <meta itemprop="name" content="{{ site.author }}">
    </div>
    
    <footer class="post-footer">
        <div class="post-nav">
            <!-- Navigation will be added in a future update -->
        </div>
    </footer>
</article>

<aside class="post-sidebar">
    {% if recent_posts %}
    <section class="widget">
        <h3>Recent Posts</h3>
        <ul class="recent-posts">
            {% for recent in recent_posts %}
            <li>
                <a href="{{ recent.url }}">{{ recent.metadata.title }}</a>
                <time>{{ recent.metadata.date.strftime('%b %d, %Y') }}</time>
            </li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}
    
    <section class="widget">
        <h3>Share</h3>
        <div class="share-buttons">
            <a href="https://twitter.com/intent/tweet?text={{ post.metadata.title|urlencode }}&url={{ site.url }}{{ post.url }}" 
               target="_blank" class="share-button twitter">Twitter</a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ site.url }}{{ post.url }}" 
               target="_blank" class="share-button linkedin">LinkedIn</a>
        </div>
    </section>
</aside>
{% endblock %}